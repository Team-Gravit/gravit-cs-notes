## 데드락

둘 이상의 프로세스(또는 스레드)가 서로 점유하고 있는 자원을 기다리면서 **영원히 진행하지 못하고 멈춰 있는 상태**를 말한다.

<br>

### 1. 데드락 발생 조건 4가지

**상호 배제**

- **한 번에 하나의 프로세스만 자원을 사용**할 수 있다. 다른 프로세스가 사용하려면 **자원이 해제될 때가지 대기**해야 한다.

**점유 대기**

- **자원을 가진 채**로 다른 프로세스가 가진 **자원을 점유하기 위해 대기**하는 프로세스가 있어야 한다.

**비선점**

- 자원을 **강제로 빼앗을 수 없다.**

**순환 대기**

- 대기 프로세스들이 **원형으로** 서로의 자원을 기다린다.

<br>

### 2. 데드락 해결 방법

**예방**

- 발생 조건 4가지 중 하나라도 발생하지 않도록 한다.
    - **상호 배제** → 공유 가능한 자원은 여러 프로세스가 동시에 사용할 수 있도록 함
    - **점유 대기** → 필요한 모든 자원을 한꺼번에 요청
    - **비선점** → 자원을 점유한 프로세스가 추가 자원을 얻지 못하면 보유 중인 자원을 강제로 회수
    - **순환 대기** → 원형이 아닌 한 방향으로만 자원을 요구
- **단점** : 성능이 떨어지거나 자원 활용이 비효율적일 수 있음

**회피**

- 데드락을 발생시키지 않으면서 프로세스들이 요구하는 모든 자원을 할당할 수 있을 때만 할당한다. (**안전 상태**)
- **안전 순서**가 존재하면 안전 상태이다.
- 대표적인 알고리즘 : **은행원 알고리즘(Banker’s Algorithm)**
    - 프로세스 시작 시 필요한 자원의 최대(Max) 개수를 미리 선언한다.
    - 각 프로세스에서 자원을 요구할 때 자원 할당이 데드락을 발생시키지 않는 안전 상태일 경우에만 할당한다.
    - 불안정 상태가 예상되면 다른 프로세스가 끝날 때까지 대기한다.

**탐지**

- 주기적으로 데드락이 발생했는지 확인한다.
    - **자원 할당 그래프**로 순환이 있는지 확인 (순환이 존재하면 데드락 발생 가능)
    - 탐지 알고리즘으로 끝낼 수 있는 프로세스가 남아있는지 반복 확인 → 끝낼 수 없으면 데드락 발생으로 판단

💡 자원 할당 그래프 : 프로세스와 자원을 정점(node), 자원 요청 관계와 할당 관계를 간선(edge)으로 나타낸 그래프

**회복**

- 프로세스를 종료시킨다.
    - 모든 프로세스 종료 : 진행 중인 프로세스도 종료되므로 부작용이 발생할 수 있음
    - 하나씩 종료 : 어떤 걸 먼저 종료할 지 선택 필요
- 자원 선점
    - 데드락을 해결하기 위해 특정 프로세스로부터 자원을 회수하여 다른 프로세스에게 할당한다.
- 희생자 선택 기준 : 우선순위가 낮고, 종료 또는 자원 회수 시 시스템에 미치는 영향이 적은 프로세스