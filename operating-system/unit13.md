## 캐시 메모리

캐시 메모리는 속도가 빠른 메모리와 느린 메모리의 **속도 차이를 줄이기 위한 고속 메모리**이다.

- 메인 메모리에서 **자주 사용하는 프로그램이나 데이터를 저장**
- **메모리 병목 현상 해결**
- **지역성의 원리를 활용**하여 적중률 향상
- 용량이 작고 비쌈

<br>

### 1. 캐시 종류

- **CPU에 가까울수록 빠르고 작음**

| 캐시 레벨 | 위치 | 용량 | 속도 |
| --- | --- | --- | --- |
| L1 | CPU 코어 내부 | 가장 작음(KB) | 가장 빠름(수 사이클) |
| L2 | CPU 코어 내부/외부 | L1보다 크고 L3보다 작음 | L1보다 느리고 L3보다 빠름 |
| L3 | CPU 코어 외부 | 가장 큼(MB) | 느림(수 십 사이클) |

<br>

### 2. 캐시 적중률

캐시가 미스되지 않고 **히트 된 횟수를 비율로 나타낸 것**으로 **적중률이 높을수록 처리속도를 향상**시킬 수 있다.

적중률을 높이기 위해서는 **지역성을 활용**해야 한다.

- **캐시 히트** : 캐시에서 원하는 데이터를 찾은 것
- **캐시 미스** : 캐시에서 원하는 데이터를 찾지 못한 것
- **적중률** = $\frac {히트수}{히트수+미스수}$

<br>

### 3. 캐시 지역성

자주 사용하는 데이터를 지역성을 기반으로 설정한다. 

- **시간 지역성** : **가장 최근에 사용한 데이터에 다시 접근**하려는 경향
    - ex) 함수 내 지역 변수, 루프 변수
- **공간 지역성** : **가장 최근에 접근한 공간에 다시 접근**하려는 경향
    - ex) 배열, 순차적 명령어

<br>

### 4. 캐싱 매핑 기법

1. **직접 매핑**
- 메인 메모리의 각 블록은 **고정된 하나의 캐시 위치**에만 매핑
- 보통 **메모리 블록 번호를 캐시 크기로 나눈 나머지**를 이용해 캐시 위치를 결정
- 특징
    - 메모리 주소는 **태그 / 인덱스 / 블록 오프셋**으로 구성됨
    - 같은 인덱스를 가진 메모리 블록은 **항상 같은 캐시 위치**를 사용함
- 장점
    - 구현이 매우 단순함
    - 주소 변환이 빠름
- 단점
    - 여러 메모리 블록이 같은 인덱스에 매핑되면 **충돌 미스(Conflict Miss)** 발생
    - 동일한 블록들을 번갈아 접근할 경우 캐시 교체가 반복되어 **적중률이 낮아짐**
    
2. **연관 매핑**
- 메인 메모리의 블록을 **캐시의 어느 위치에나** 자유롭게 저장할 수 있는 방식
- 메모리 블록과 캐시 위치 사이에 **고정된 대응 관계가 없음**
- 특징
    - 캐시의 **모든 라인을 대상으로 태그를 비교**하여 데이터 검색
    - 메모리 주소는 **태그 / 블록 오프셋**으로 구성됨
- 장점
    - **충돌 미스가 거의 발생하지 않음**
    - 필요한 데이터 위주로 캐시에 유지 가능 → **적중률 높음**
- 단점
    - 모든 캐시 라인을 비교해야 하므로 **하드웨어가 복잡**
    - **검색 비용이 큼**

3. **집합 연관 매핑**
- **직접 매핑과 연관 매핑을 합친 것**이다.
- 캐시를 여러 집합으로 나누고, 각 메모리 블록은 **특정 집합에 매핑**되지만 그 집합 내에서는 **자유롭게 저장**된다.
- 특징
    - 메모리 주소는 **태그 / 집합 인덱스 / 블록 오프셋**으로 구성됨
    - **지정된 집합 내에서만 검색**하므로 비교 범위가 제한됨
- 장점
    - 직접 매핑보다 **충돌이 적음**
    - 연관 매핑보다 **검색 비용이 낮음**
    - **적중률과 구현 복잡도의 균형**이 좋음
- 단점
    - 직접 매핑보다 하드웨어가 복잡함