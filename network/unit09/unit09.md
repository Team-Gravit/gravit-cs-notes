## TCP(Transmission Control Protocol)

**TCP**는 인터넷에서 데이터를 안정적으로 전달하기 위한 **전송 계층 프로토콜**이다. **IP**의 단점(패킷 순서 보장 불가, 패킷 유실 등)을 보완하여 **패킷 전송을 제어하고 신뢰성을 보증**한다.

<br>

### 1. TCP/IP

**TCP/IP**는 **TCP**와 **IP**를 함께 사용하는 인터넷 통신의 기본 규칙 세트이다.

- **IP**(Internet Protocol): 데이터를 어디로 보낼지 주소를 정하고 전달함
- **TCP**(Transmission Control Protocol): 데이터가 순서대로 정확히 도착했는지 확인함

<br>

### 2. TCP/IP 동작 흐름

웹 브라우저가 **HTTP 요청**을 보내서 웹 서버가 응답하는 과정이다.

1. **응용 계층**에서 **HTTP 메시지** 생성
2. **전송 계층**(TCP)에서 **세그먼트** 단위로 분할하고 **순서 번호(Sequence Number)** 부여
3. **인터넷 계층**(IP)에서 목적지 **IP 주소**를 부여하고 경로 설정
4. **네트워크 링크**를 통해 물리적으로 전달
5. 수신 측에서 **세그먼트**를 재조합하고 오류 시 재요청 후 **응용 계층**에 전달

<br>

### 3. OSI 7계층과 연관성

| OSI 계층 | TCP/IP 모델 | 설명 |
| --- | --- | --- |
| **응용 계층**(Application) | **응용 계층** | HTTP, FTP 등 사용자 서비스 동작 |
| **전송 계층**(Transport) | **TCP** | 세그먼트 분할, 순서 및 정확성 보장 |
| **네트워크 계층**(Network) | **IP 계층** | IP 주소 부여, 경로 선택 |
| **데이터 링크 계층**(Data Link) | **네트워크 인터페이스 계층** | 프레임 단위 전송, MAC 주소 기반 통신 |

<br>

### 4. TCP 연결형 프로토콜

**TCP**는 **연결형 프로토콜**(Connection-Oriented Protocol)이다. 데이터를 주고받기 전에 **통신 가능 상태를 확인하고 연결을 맺는 절차**가 필요하다. 정확한 전송을 보장하기 위해 **3-Way Handshake** 방식을 사용한다.

<br>

### 5. 3-Way Handshake

<img src="image.png" width="100%">

1. **SYN**: 클라이언트가 서버에 연결 요청, **SYN 플래그**를 **1**로 설정한 패킷 전송
2. **SYN + ACK**: 서버가 연결 수락, **SYN**과 **ACK** 플래그를 함께 전송
3. **ACK**: 클라이언트가 확인 응답, 연결 성립

<br>

### 6. Sequence Number와 Ack Number

**TCP**는 데이터를 **바이트 단위**로 관리한다.

- **seq**: 현재 패킷의 시작 바이트 번호
- **ack**: 다음에 받아야 할 바이트 번호

<br>

**3-Way Handshake 번호 변화 예시**

1. **SYN**: `seq = 100` (클라이언트가 100번부터 시작)
2. **SYN+ACK**: `seq = 300, ack = 101` (서버가 300번부터 시작, 클라이언트는 101번부터 전송 요청)
3. **ACK**: `seq = 101, ack = 301` (클라이언트가 101번부터 전송, 서버는 301번부터 전송 요청)

<br>

### 7. 4-Way Handshake

연결 종료 시 **4-Way Handshake**를 사용한다.

1. 클라이언트가 `CLOSE()` 호출, **FIN 플래그** 전송, **FIN_WAIT1** 상태로 전환
2. 서버가 **ACK 플래그** 전송, **CLOSE_WAIT** 상태로 전환
3. 서버가 `CLOSE()` 호출, **FIN 플래그** 전송, 클라이언트는 **FIN_WAIT2** 상태
4. 클라이언트가 **ACK 플래그** 전송, **TIME_WAIT** 후 **CLOSED** 상태로 전환

<br>

## UDP(User Datagram Protocol)

**UDP**는 인터넷 통신에서 데이터를 빠르게 보내기 위한 **전송 계층 프로토콜**이다. **TCP**처럼 연결을 맺거나 신뢰성을 확보하지 않고 **즉시 전송**하는 방식이다.

<br>

### 1. UDP 특징

- **비연결형**: 핸드셰이크 없이 즉시 전송함
- **신뢰성 낮음**: 데이터 유실, 순서 변경, 중복 발생 가능하나 보정하지 않음
- **헤더 단순**: 출발 포트, 도착 포트, 길이, 체크섬으로 구성됨
- **지연 및 오버헤드 적음**: 신호 교환이 없어 빠른 전송 가능
- **멀티캐스트/브로드캐스트 지원**: 여러 수신자에게 전송 가능

<br>

### 2. 동작 방식

1. **송신 측**: **UDP 소켓**에 데이터 작성, 출발지/목적지 포트 설정, **데이터그램** 생성 후 즉시 전송
2. **네트워크**: **IP 계층**을 거쳐 전달, 중간에 손실 가능
3. **수신 측**: 포트 번호로 소켓 식별, **데이터그램**을 수신 버퍼에 저장, 애플리케이션이 읽거나 버림

<br>

### 3. UDP 단순 설계 이유

- **지연 제거**: **ACK** 확인, 재전송, 순서 정렬 과정이 없음
- **낮은 오버헤드**: **TCP** 헤더는 **20바이트** 이상, **UDP**는 **8바이트**
- **응용 계층 보완 가능**: 필요 시 응용 계층에서 자체적으로 **ACK/재전송** 구현 가능

<br>

## TCP vs UDP

| 구분 | TCP | UDP |
| --- | --- | --- |
| **연결 방식** | 3-Way Handshake로 연결 확립 | 연결 없음 |
| **전송 단위** | 바이트 스트림 (순서 보장) | 데이터그램 (독립적 전송) |
| **오류 제어** | 재전송, 순서 복원, 흐름/혼잡 제어 존재 | 없음 |
| **종료 절차** | 4-Way Handshake | 없음 |
| **전송 확인** | ACK로 확인 | 없음 |
| **속도** | 느림 (제어 과정 존재) | 빠름 (제어 과정 없음) |