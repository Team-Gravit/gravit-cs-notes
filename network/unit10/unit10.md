## 포트(Port)

**포트**는 한 컴퓨터 안에서 **프로세스를 구분**하기 위한 논리적 번호이다. **운영 체제 통신의 종단점**을 의미한다.

<br>

**IP 주소**가 어느 컴퓨터인지를 구분한다면, **포트**는 그 컴퓨터 안의 어떤 프로그램인지를 구분한다.

**예시**

- `192.168.0.10:80` → 해당 IP의 웹 서버(HTTP)
- `192.168.0.10:22` → 같은 컴퓨터의 SSH 서버

<br>

### 1. 포트의 역할

**프로세스 식별**

- 하나의 컴퓨터에서 여러 네트워크 프로그램이 동시에 실행될 수 있음
- 각 프로그램은 고유한 포트 번호로 데이터를 수신함

<br>

**다중 통신 지원**

- **송신 측**: 여러 응용 프로그램의 데이터를 하나의 네트워크로 **다중화**(Multiplexing)함
- **수신 측**: 포트 번호를 기준으로 데이터를 **분리**(Demultiplexing)함

<br>

### 2. 포트 번호 범위

| 구분 | 범위 | 설명 | 예시 |
| --- | --- | --- | --- |
| **Well-known Port** | 0 ~ 1023 | 국제적으로 예약된 표준 서비스용 포트 | 80(HTTP), 443(HTTPS), 22(SSH) |
| **Registered Port** | 1024 ~ 49151 | 일반 애플리케이션이 등록하여 사용하는 포트 | 3306(MySQL), 8080(Tomcat) |
| **Dynamic/Private Port** | 49152 ~ 65535 | 클라이언트가 임시로 사용하는 포트 | 브라우저의 임시 통신용 |

<br>

### 3. URL에서의 포트 번호

**URL 구성**: `프로토콜://도메인:포트번호/경로`

**예시**: `https://example.com:8080/index.html`

- `https://` → 프로토콜
- `example.com` → 도메인
- `8080` → 포트 번호
- `/index.html` → 리소스 경로

<br>

### 4. 기본 포트

각 프로토콜은 기본 포트를 가지므로 **URL에서 포트 번호 생략 가능**하다.

| 프로토콜 | 기본 포트 | 생략 시 실제 포트 |
| --- | --- | --- |
| **HTTP** | 80 | [http://example.com](http://example.com/) → :80 |
| **HTTPS** | 443 | [https://example.com](https://example.com/) → :443 |
| **FTP** | 21 | [ftp://example.com](ftp://example.com/) → :21 |
| **SSH** | 22 | ssh://example.com → :22 |

<br>

## 소켓(Socket)

**소켓**은 네트워크를 통해 떨어져 있는 프로세스끼리 데이터를 주고받을 수 있게 하는 **종착점**이다. **전송 계층과 응용 프로그램 사이의 인터페이스 역할**을 한다.

<br>

### 1. 소켓이 필요한 이유

**클라이언트 연결 관리**

- 서버는 다수의 클라이언트 요청을 동시에 처리해야 함
- 각 클라이언트마다 독립적인 소켓을 생성하여 연결 정보를 관리함

<br>

**응용 프로그램 구분**

- 한 컴퓨터에서 여러 응용 프로그램이 네트워크를 사용할 수 있음
- 포트와 결합된 소켓 구조로 어떤 프로그램이 데이터를 받을지 구분함

<br>

**전송 계층 인터페이스**

- 응용 계층이 소켓을 통해 **전송 계층(TCP/UDP)** 기능을 사용함

<br>

### 2. 소켓의 3요소

| 구성 요소 | 설명 | 예시 |
| --- | --- | --- |
| **프로토콜**(Protocol) | 전송 방식(TCP 또는 UDP) | TCP |
| **IP 주소**(IP Address) | 통신 대상의 네트워크 위치 | 192.168.0.10 |
| **포트 번호**(Port Number) | 프로세스 식별자 | 8080 |

하나의 소켓은 **프로토콜 + IP + 포트**의 조합으로 유일하게 구분된다.

<br>

### 3. TCP 소켓 통신 흐름

**TCP** 기반 소켓은 **연결 지향적**이며, **3-Way Handshake → 데이터 송수신 → 4-Way Handshake** 과정을 거친다.

<img src="image1.png" width="100%">

<br>

<br>

**서버(Server)**

| 단계 | 함수 | 설명 |
| --- | --- | --- |
| ① | socket() | 소켓 생성 |
| ② | bind() | IP 주소와 포트 번호를 소켓에 할당 |
| ③ | listen() | 클라이언트 연결 요청 대기 |
| ④ | accept() | 연결 요청 수락, 새 통신용 소켓 생성 |
| ⑤ | read()/write() | 데이터 수신 및 응답 전송 |
| ⑥ | close() | 연결 종료 |

<br>

**클라이언트(Client)**

| 단계 | 함수 | 설명 |
| --- | --- | --- |
| ① | socket() | 소켓 생성 |
| ② | connect() | 서버의 IP:Port로 연결 요청 |
| ③ | write()/read() | 데이터 전송 및 응답 수신 |
| ④ | close() | 연결 종료 |

<br>

### 4. UDP 소켓 통신 흐름

**UDP** 기반 소켓은 **비연결형**이며, 연결 설정 없이 즉시 데이터를 전송한다.

<img src="image2.png" width="100%">

<br>

<br>

**서버(Server)**

| 단계 | 함수 | 설명 |
| --- | --- | --- |
| ① | socket() | 소켓 생성 |
| ② | bind() | 수신용 포트 설정(선택적) |
| ③ | recvfrom() | 데이터 수신 |
| ④ | close() | 소켓 종료 |

<br>

**클라이언트(Client)**

| 단계 | 함수 | 설명 |
| --- | --- | --- |
| ① | socket() | 소켓 생성 |
| ② | sendto() | 서버의 IP:Port로 데이터 전송 |
| ③ | close() | 소켓 종료 |

### 5. HTTP 통신 vs Socket 통신

**HTTP 통신**

- 클라이언트의 요청이 있을 때만 서버가 응답하고 연결을 종료하는 **단방향 통신**
- **TCP를 매번 새로 열고 닫는 구조**
- 실시간 연결이 아닌 필요 시에만 요청하는 상황에 유용함

<br>

**Socket 통신**

- 서버와 클라이언트가 **특정 포트를 통해 실시간 양방향 통신**하는 방식
- **TCP 연결을 계속 유지하는 구조**
- 실시간 데이터 전송이 필요한 경우에 사용함(실시간 스트리밍, 온라인 게임 등)
- 연결을 계속 유지하므로 **HTTP 통신보다 많은 리소스를 소모**함

<br>

## NAT(Network Address Translation)

**NAT**는 **네트워크 주소를 변환하는 기술**로, 내부 네트워크의 **사설 IP**를 외부 인터넷에서 사용하는 **공인 IP**로 변환하거나 그 반대로 변환한다.

<br>

### 1. NAT가 필요한 이유

- **공인 IP 주소 절약**: **IPv4** 주소 공간이 제한적이므로 여러 기기가 하나의 공인 IP를 공유함
- **네트워크 보안 강화**: 외부에서 내부 기기의 사설 IP를 직접 알 수 없음
- **네트워크 설계 유연성**: 내부망 IP 체계가 외부망과 독립적으로 운영됨

<br>

### 2. NAT 동작 원리

내부망에서 사설 IP를 가진 기기가 외부로 패킷을 보낼 때, **NAT 장비가 출발지 IP 주소 또는 포트 번호를 변환**한다. 응답 패킷이 도착하면 **매핑 정보를 보고 다시 내부 사설 IP로 되돌려 전달**한다.

<br>

**변환 과정 예시**

- 내부 기기: `192.168.0.5:5000` → 공유기 → 외부 서버
- 공유기 변환: `192.168.0.5:5000` → `203.0.113.10:60000`
- 서버 응답: `203.0.113.10:60000` → 공유기 → `192.168.0.5:5000`

<br>

### 3. NAT 주요 유형

**Static NAT(정적 NAT)**

- 하나의 **내부 사설 IP**를 **특정 공인 IP**로 고정 매핑함
- 특정 서버가 항상 동일한 공인 IP로 접근해야 하는 경우에 사용함
- 내부 웹 서버를 외부에서 접근할 때 활용함

<br>

**Dynamic NAT(동적 NAT)**

- 내부 사설 IP를 **여러 공인 IP 풀에서 동적으로 할당**하여 변환함
- 사용하지 않는 IP를 재활용 가능하지만 공인 IP가 제한적임
- 기업 내부 네트워크에서 활용함

<br>

**PAT(Port Address Translation) 또는 NAPT**

- **하나의 공인 IP**를 여러 내부 사설 IP가 공유하는 방식
- 패킷의 출발지 포트 번호를 변환하여 다수의 내부 IP가 하나의 공인 IP를 사용함
- **가장 많이 사용되는 NAT 방식**
- 가정용 공유기, 기업 내부 네트워크에서 활용함

<br>

### 4. SNAT(Source NAT)

**출발지 IP 주소를 변환**하는 NAT 방식이다. 내부 네트워크에서 외부로 패킷을 전송할 때 출발지 IP 주소를 변경한다.

**예시**: 내부 `192.168.1.100` → 외부로 나갈 때 `203.0.113.10`으로 변경

**활용 사례**

- 기업 내부의 다수 사용자가 하나의 공인 IP로 인터넷에 접근할 때
- 클라우드 환경에서 특정 IP로만 외부와 통신하도록 설정할 때

<br>

### 5. DNAT(Destination NAT)

**목적지 IP 주소를 변환**하는 NAT 방식이다. 외부에서 특정 공인 IP로 접속하면 내부 사설 IP로 변환하여 접속한다.

**예시**: 외부에서 `203.0.113.10` 접속 → 내부 서버 `192.168.1.10`으로 변환

**활용 사례**

- 내부 웹 서버를 외부에서 접근할 수 있도록 할 때
- 게임 서버, VPN 서버 등 외부에서 특정 서버로 접근할 때